C51 COMPILER V9.60.0.0   MAIN                                                              08/18/2020 19:52:21 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /***********************************************
   2          基于STC15F2K60S2系列单片机C语言编程实现
   3          使用如下头文件，不用另外再包含"REG51.H"
   4          #include <STC15F2K60S2.h>
   5          ***********************************************/
   6          #include "sys_fun.h"
   7          #include "songs.h"
   8          #include "display.h"
   9          #include "sing.h"
  10          
  11          uchar port_status;
  12          uchar key;
  13          unsigned char Count;
  14          double range = 1;
  15          uchar iniT;
  16          
  17          void Time0_Int() interrupt 1
  18          {
  19   1         TH0 = 0xDC;
  20   1         TL0 = 0x00;
  21   1         Count++;   
  22   1      }
  23          
  24          void Timer1() interrupt 3{
  25   1        bee_Speak = ~bee_Speak;
  26   1      }
  27          
  28          void main()
  29          {
  30   1        P5M1=0x00;
  31   1        P5M0=0x30;
  32   1        
  33   1        P4M1=0xC0;
  34   1        P4M0=0x00;
  35   1        
  36   1        P3M1=0x00;
  37   1        P3M0=0x00;
  38   1        
  39   1        Ini_Lcd();//液晶初始化子程序
  40   1        /*Disp(1,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  41   1        Disp(2,1,12,"电子线路设计");//显示数据到LCD12864子程序
  42   1        Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
  43   1        Disp(4,1,12,"液晶显示成功");//显示数据到LCD12864子程序*/
  44   1        while(1)
  45   1        {
  46   2          
  47   2          /*if((ctrl_port_check()&0xF0)==0xF0)
  48   2          {   
  49   2            s1_s2_check();
  50   2            P4M1=0x00;
  51   2            P4M0=0x00;
  52   2            Ini_Lcd();//液晶初始化子程序
  53   2            Disp(1,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  54   2            Disp(2,1,12,"电子线路设计");//显示数据到LCD12864子程序
  55   2            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
C51 COMPILER V9.60.0.0   MAIN                                                              08/18/2020 19:52:21 PAGE 2   

  56   2            Disp(4,1,12,"液晶显示成功");//显示数据到LCD12864子程序
  57   2            Delay_xMs(2500);    
  58   2          }*/
  59   2          
  60   2          if(!(ctrl_port_check()&0x80))
  61   2          { 
  62   3            KeyIO=0xF0;
  63   3            Ini_Lcd();//液晶初始化子程序
  64   3            Disp(1,0,16,"系统进行按键检测");//显示数据到LCD12864子程序
  65   3            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
  66   3            Disp(4,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  67   3            while(!(ctrl_port_check()&0x80))
  68   3            {
  69   4              s1_s2_check();        
  70   4              if((P1&0xf0)!=0xf0) //如果有键按下
  71   4                  {
  72   5                      Delay_xMs(100);   //延时去抖动
  73   5                      if((KeyIO&0xf0)!=0xf0)   //再判断
  74   5                      {
  75   6                  key=scankey();
  76   6                  switch(key)
  77   6                  {
  78   7                    case 11:Disp(2,1,12,"KEY_VALUE:01");  break;//显示数据到LCD12864子程序
  79   7                    case 12:Disp(2,1,12,"KEY_VALUE:02");  break;//显示数据到LCD12864子程序
  80   7                    case 13:Disp(2,1,12,"KEY_VALUE:03");  break;//显示数据到LCD12864子程序
  81   7                    case 14:Disp(2,1,12,"KEY_VALUE:04");  break;//显示数据到LCD12864子程序
  82   7                    case 21:Disp(2,1,12,"KEY_VALUE:05");  break;//显示数据到LCD12864子程序
  83   7                    case 22:Disp(2,1,12,"KEY_VALUE:06");  break;//显示数据到LCD12864子程序
  84   7                    case 23:Disp(2,1,12,"KEY_VALUE:07");  break;//显示数据到LCD12864子程序
  85   7                    case 24:Disp(2,1,12,"KEY_VALUE:08");  break;//显示数据到LCD12864子程序
  86   7                    case 31:Disp(2,1,12,"KEY_VALUE:09");  break;//显示数据到LCD12864子程序
  87   7                    case 32:Disp(2,1,12,"KEY_VALUE:10");  break;//显示数据到LCD12864子程序
  88   7                    case 33:Disp(2,1,12,"KEY_VALUE:11");  break;//显示数据到LCD12864子程序
  89   7                    case 34:Disp(2,1,12,"KEY_VALUE:12");  break;//显示数据到LCD12864子程序
  90   7                    case 41:Disp(2,1,12,"KEY_VALUE:13");  break;//显示数据到LCD12864子程序
  91   7                    case 42:Disp(2,1,12,"KEY_VALUE:14");  break;//显示数据到LCD12864子程序
  92   7                    case 43:Disp(2,1,12,"KEY_VALUE:15");  break;//显示数据到LCD12864子程序
  93   7                    case 44:Disp(2,1,12,"KEY_VALUE:16");  break;//显示数据到LCD12864子程序
  94   7                  }
  95   6                }   
  96   5              }
  97   4            }
  98   3          }
  99   2          else if(!(ctrl_port_check()&0x40))
 100   2          { 
 101   3            s1_s2_check();
 102   3            Ini_Lcd();//液晶初始化子程序
 103   3            Disp(1,0,16,"系统进行音乐播放");//显示数据到LCD12864子程序
 104   3            Disp(2,1,13,"Playing Music");//显示数据到LCD12864子程序  
 105   3            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
 106   3            Disp(4,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序    
 107   3            Time0_Init();
 108   3            Play_Song(0);      
 109   3          } 
 110   2          else if(!(ctrl_port_check()&0x20))
 111   2          { 
 112   3            Disp(1,0,16,"系统进行光耦检测");//显示数据到LCD12864子程序
 113   3            while(!(ctrl_port_check()&0x20)) {
 114   4              s1_s2_check();
 115   4              OPT_CHECK = 0xFF;
 116   4              iniT = 0xFFFF - GetCycle(OPT_CHECK, range) + 1;
 117   4              TMOD = 0x10;
C51 COMPILER V9.60.0.0   MAIN                                                              08/18/2020 19:52:21 PAGE 3   

 118   4              ET1 = 1;
 119   4              EA = 1;
 120   4              TH1 = iniT >> 8;
 121   4              TL1 = iniT & 0x00FF;
 122   4              TR1 = 1;
 123   4              Delay_xMs(2500);
 124   4            }
 125   3          } 
 126   2      
 127   2        }
 128   1      }
 129          
 130          /*******************定时器初始化********************/
 131          void Time0_Init()
 132          {
 133   1       TMOD = 0x01;
 134   1       IE   = 0x82;
 135   1       TH0  = 0xDC;
 136   1       TL0  = 0x00;  //11.0592MZ
 137   1      }
 138          /****************播放音乐*************************/
 139          void s1_s2_check(void)
 140          {
 141   1        if(P4&0x40) 
 142   1          DLED_1 =1;
 143   1        else  
 144   1          DLED_1 =0;
 145   1        if((P4&0x80)) 
 146   1          DLED_2 =1;
 147   1        else  
 148   1          DLED_2 =0;
 149   1      }
 150          
 151          /****************播放音乐*************************/
 152          void Play_Song(unsigned char i)
 153          {
 154   1         unsigned char Temp1,Temp2;
 155   1         unsigned int Addr;
 156   1         Count = 0;      
 157   1         Addr = i * 217;  
 158   1         while(!(ctrl_port_check()&0x40))
 159   1         {
 160   2             Temp1 = SONG[Addr++];
 161   2             if ( Temp1 == 0xFF )         
 162   2             {
 163   3                TR0 = 0;                 
 164   3                Delay_xMs(100);
 165   3             }
 166   2             else if ( Temp1 == 0x00 )   
 167   2             {
 168   3                return;
 169   3             }
 170   2             else
 171   2             {
 172   3                Temp2 = SONG[Addr++];
 173   3                TR0 = 1;
 174   3              while(!(ctrl_port_check()&0x40))
 175   3              {
 176   4                 bee_Speak = ~bee_Speak;
 177   4                 Delay_xMs(Temp1);
 178   4                 if ( Temp2 == Count )
 179   4                 {
C51 COMPILER V9.60.0.0   MAIN                                                              08/18/2020 19:52:21 PAGE 4   

 180   5                    Count = 0;
 181   5                    break;
 182   5                 }
 183   4              }
 184   3             }
 185   2        }
 186   1        bee_Speak = 0;  //关闭蜂鸣器
 187   1      }
 188          
 189          
 190          /*****************检测控制端口的状态*****************/
 191          uchar ctrl_port_check(void)
 192          {
 193   1          SW_CTRL = 0xFF;
 194   1          return  SW_CTRL&0xF0;
 195   1      }
 196          
 197          uchar scankey(void)//矩阵键盘翻转扫描
 198          {
 199   1        uint keyvalue=0;
 200   1        uchar temp1,temp2,keycode;
 201   1      
 202   1        KeyIO=0xf0;   //行置0列置1
 203   1        temp1=KeyIO&0xf0;
 204   1        if((temp1&0xf0)==0xf0) return(0);  //若无键按下返回0
 205   1        KeyIO=0x0f;
 206   1        temp2=KeyIO&0x0f;            //若有键按下，行置1列置0
 207   1        keycode=~(temp1|temp2);        //获得键盘码
 208   1        switch(keycode)            //根据键盘码返回键值
 209   1        {
 210   2          case 0x11:return(11);break;
 211   2          case 0x21:return(12);break;
 212   2          case 0x41:return(13);break;
 213   2          case 0x81:return(14);break;
 214   2          case 0x12:return(21);break;
 215   2          case 0x22:return(22);break;
 216   2          case 0x42:return(23);break;
 217   2          case 0x82:return(24);break;
 218   2          case 0x14:return(31);break;
 219   2          case 0x24:return(32);break;
 220   2          case 0x44:return(33);break;
 221   2          case 0x84:return(34);break;
 222   2          case 0x18:return(41);break;
 223   2          case 0x28:return(42);break;
 224   2          case 0x48:return(43);break;
 225   2          case 0x88:return(44);break;
 226   2          default:  return(0);break;
 227   2        }
 228   1        return(0);
 229   1      }
 230             
 231          /****************延迟毫秒数************************/
 232          void Delay_xMs(unsigned int x)
 233          {
 234   1          unsigned int i,j;
 235   1          for( i = 0;i < x;i++ )
 236   1          {
 237   2              for( j = 0;j<2;j++ );
 238   2          }
 239   1      }
 240          
*** WARNING C294 IN LINE 228 OF main.c: unreachable code
C51 COMPILER V9.60.0.0   MAIN                                                              08/18/2020 19:52:21 PAGE 5   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    995    ----
   CONSTANT SIZE    =    516    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
