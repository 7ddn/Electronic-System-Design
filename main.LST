C51 COMPILER V9.60.0.0   MAIN                                                              08/19/2020 14:51:39 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /***********************************************
   2          基于STC15F2K60S2系列单片机C语言编程实现
   3          使用如下头文件，不用另外再包含"REG51.H"
   4          #include <STC15F2K60S2.h>
   5          ***********************************************/
   6          #include "sys_fun.h"
   7          #include "songs.h"
   8          #include "display.h"
   9          #include "sing.h"
  10          
  11          uchar port_status;
  12          uchar key;
  13          unsigned char Count;
  14          double range = 1;
  15          
  16          void Time0_Int() interrupt 1
  17          {
  18   1         TH0 = 0xDC;
  19   1         TL0 = 0x00;
  20   1         Count++;   
  21   1      }
  22          
  23          void Playnote(uchar flag, int i){
  24   1        OPT_CHECK = 0xFF;
  25   1        while (OPT_CHECK&flag){
  26   2          bee_Speak = ~bee_Speak;
  27   2          Delay_xMs(NOTE[i-1]);
  28   2          OPT_CHECK = 0xFF;
  29   2        }
  30   1      }
  31          
  32          void main()
  33          {
  34   1        P5M1=0x00;
  35   1        P5M0=0x30;
  36   1        
  37   1        P4M1=0xC0;
  38   1        P4M0=0x00;
  39   1        
  40   1        P3M1=0x00;
  41   1        P3M0=0x00;
  42   1        
  43   1        Ini_Lcd();//液晶初始化子程序
  44   1        Disp(1,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  45   1        Disp(2,1,12,"电子线路设计");//显示数据到LCD12864子程序
  46   1        Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
  47   1        Disp(4,1,12,"液晶显示成功");//显示数据到LCD12864子程序*/
  48   1        while(1)
  49   1        {
  50   2          
  51   2          if((ctrl_port_check()&0xF0)==0xF0)
  52   2          {   
  53   3            s1_s2_check();
  54   3            P4M1=0x00;
  55   3            P4M0=0x00;
C51 COMPILER V9.60.0.0   MAIN                                                              08/19/2020 14:51:39 PAGE 2   

  56   3            Ini_Lcd();//液晶初始化子程序
  57   3            Disp(1,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  58   3            Disp(2,1,12,"电子线路设计");//显示数据到LCD12864子程序
  59   3            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
  60   3            Disp(4,1,12,"液晶显示成功");//显示数据到LCD12864子程序
  61   3            Delay_xMs(2500);    
  62   3          }
  63   2          
  64   2          if(!(ctrl_port_check()&0x80))
  65   2          { 
  66   3            KeyIO=0xF0;
  67   3            Ini_Lcd();//液晶初始化子程序
  68   3            Disp(1,0,16,"系统进行按键检测");//显示数据到LCD12864子程序
  69   3            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
  70   3            Disp(4,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序      
  71   3            while(!(ctrl_port_check()&0x80))
  72   3            {
  73   4              s1_s2_check();        
  74   4              if((P1&0xf0)!=0xf0) //如果有键按下
  75   4                  {
  76   5                      Delay_xMs(100);   //延时去抖动
  77   5                      if((KeyIO&0xf0)!=0xf0)   //再判断
  78   5                      {
  79   6                  key=scankey();
  80   6                  switch(key)
  81   6                  {
  82   7                    case 11:Disp(2,1,12,"KEY_VALUE:01");  break;//显示数据到LCD12864子程序
  83   7                    case 12:Disp(2,1,12,"KEY_VALUE:02");  break;//显示数据到LCD12864子程序
  84   7                    case 13:Disp(2,1,12,"KEY_VALUE:03");  break;//显示数据到LCD12864子程序
  85   7                    case 14:Disp(2,1,12,"KEY_VALUE:04");  break;//显示数据到LCD12864子程序
  86   7                    case 21:Disp(2,1,12,"KEY_VALUE:05");  break;//显示数据到LCD12864子程序
  87   7                    case 22:Disp(2,1,12,"KEY_VALUE:06");  break;//显示数据到LCD12864子程序
  88   7                    case 23:Disp(2,1,12,"KEY_VALUE:07");  break;//显示数据到LCD12864子程序
  89   7                    case 24:Disp(2,1,12,"KEY_VALUE:08");  break;//显示数据到LCD12864子程序
  90   7                    case 31:Disp(2,1,12,"KEY_VALUE:09");  break;//显示数据到LCD12864子程序
  91   7                    case 32:Disp(2,1,12,"KEY_VALUE:10");  break;//显示数据到LCD12864子程序
  92   7                    case 33:Disp(2,1,12,"KEY_VALUE:11");  break;//显示数据到LCD12864子程序
  93   7                    case 34:Disp(2,1,12,"KEY_VALUE:12");  break;//显示数据到LCD12864子程序
  94   7                    case 41:Disp(2,1,12,"KEY_VALUE:13");  break;//显示数据到LCD12864子程序
  95   7                    case 42:Disp(2,1,12,"KEY_VALUE:14");  break;//显示数据到LCD12864子程序
  96   7                    case 43:Disp(2,1,12,"KEY_VALUE:15");  break;//显示数据到LCD12864子程序
  97   7                    case 44:Disp(2,1,12,"KEY_VALUE:16");  break;//显示数据到LCD12864子程序
  98   7                  }
  99   6                }   
 100   5              }
 101   4            }
 102   3          }
 103   2          else if(!(ctrl_port_check()&0x40))
 104   2          { 
 105   3            s1_s2_check();
 106   3            Ini_Lcd();//液晶初始化子程序
 107   3            Disp(1,0,16,"系统进行音乐播放");//显示数据到LCD12864子程序
 108   3            Disp(2,1,13,"Playing Music");//显示数据到LCD12864子程序  
 109   3            Disp(3,2,8,"87951197");//显示数据到LCD12864子程序
 110   3            Disp(4,0,16,"浙江大学光电学院");//显示数据到LCD12864子程序    
 111   3            Time0_Init();
 112   3            Play_Song(0);      
 113   3          } 
 114   2          else if(!(ctrl_port_check()&0x20))
 115   2          { 
 116   3            s1_s2_check();
 117   3            Ini_Lcd();
C51 COMPILER V9.60.0.0   MAIN                                                              08/19/2020 14:51:39 PAGE 3   

 118   3            Disp(1,4,8,"演奏模式");//显示数据到LCD12864子程序
 119   3            while(!(ctrl_port_check()&0x20)) {
 120   4              OPT_CHECK = 0xFF;
 121   4              if (OPT_CHECK&0x01) Playnote(0x01, 7);
 122   4               else if (OPT_CHECK&0x02) Playnote(0x02, 6);
 123   4               else if (OPT_CHECK&0x04) Playnote(0x04, 5);
 124   4               else if (OPT_CHECK&0x08) Playnote(0x08, 4);
 125   4               else if (OPT_CHECK&0x10) Playnote(0x10, 3);
 126   4               else if (OPT_CHECK&0x20) Playnote(0x20, 2);
 127   4               else if (OPT_CHECK&0x40) Playnote(0x40, 1);
 128   4              
 129   4            }
 130   3          } 
 131   2      
 132   2        }
 133   1      }
 134          
 135          /*******************定时器初始化********************/
 136          void Time0_Init()
 137          {
 138   1       TMOD = 0x01;
 139   1       IE   = 0x82;
 140   1       TH0  = 0xDC;
 141   1       TL0  = 0x00;  //11.0592MZ
 142   1      }
 143          /****************播放音乐*************************/
 144          void s1_s2_check(void)
 145          {
 146   1        if(P4&0x40) 
 147   1          DLED_1 =1;
 148   1        else  
 149   1          DLED_1 =0;
 150   1        if((P4&0x80)) 
 151   1          DLED_2 =1;
 152   1        else  
 153   1          DLED_2 =0;
 154   1      }
 155          
 156          /****************播放音乐*************************/
 157          void Play_Song(unsigned char i)
 158          {
 159   1         unsigned char Temp1,Temp2;
 160   1         unsigned int Addr;
 161   1         Count = 0;      
 162   1         Addr = i * 217;  
 163   1         while(!(ctrl_port_check()&0x40))
 164   1         {
 165   2             Temp1 = SONG[Addr++];
 166   2             if ( Temp1 == 0xFF )         
 167   2             {
 168   3                TR0 = 0;                 
 169   3                Delay_xMs(100);
 170   3             }
 171   2             else if ( Temp1 == 0x00 )   
 172   2             {
 173   3                return;
 174   3             }
 175   2             else
 176   2             {
 177   3                Temp2 = SONG[Addr++];
 178   3                TR0 = 1;
 179   3              while(!(ctrl_port_check()&0x40))
C51 COMPILER V9.60.0.0   MAIN                                                              08/19/2020 14:51:39 PAGE 4   

 180   3              {
 181   4                 bee_Speak = ~bee_Speak;
 182   4                 Delay_xMs(Temp1);
 183   4                 if ( Temp2 == Count )
 184   4                 {
 185   5                    Count = 0;
 186   5                    break;
 187   5                 }
 188   4              }
 189   3             }
 190   2        }
 191   1        bee_Speak = 0;  //关闭蜂鸣器
 192   1      }
 193          
 194          
 195          /*****************检测控制端口的状态*****************/
 196          uchar ctrl_port_check(void)
 197          {
 198   1          SW_CTRL = 0xFF;
 199   1          return  SW_CTRL&0xF0;
 200   1      }
 201          
 202          uchar scankey(void)//矩阵键盘翻转扫描
 203          {
 204   1        uint keyvalue=0;
 205   1        uchar temp1,temp2,keycode;
 206   1      
 207   1        KeyIO=0xf0;   //行置0列置1
 208   1        temp1=KeyIO&0xf0;
 209   1        if((temp1&0xf0)==0xf0) return(0);  //若无键按下返回0
 210   1        KeyIO=0x0f;
 211   1        temp2=KeyIO&0x0f;            //若有键按下，行置1列置0
 212   1        keycode=~(temp1|temp2);        //获得键盘码
 213   1        switch(keycode)            //根据键盘码返回键值
 214   1        {
 215   2          case 0x11:return(11);break;
 216   2          case 0x21:return(12);break;
 217   2          case 0x41:return(13);break;
 218   2          case 0x81:return(14);break;
 219   2          case 0x12:return(21);break;
 220   2          case 0x22:return(22);break;
 221   2          case 0x42:return(23);break;
 222   2          case 0x82:return(24);break;
 223   2          case 0x14:return(31);break;
 224   2          case 0x24:return(32);break;
 225   2          case 0x44:return(33);break;
 226   2          case 0x84:return(34);break;
 227   2          case 0x18:return(41);break;
 228   2          case 0x28:return(42);break;
 229   2          case 0x48:return(43);break;
 230   2          case 0x88:return(44);break;
 231   2          default:  return(0);break;
 232   2        }
 233   1        return(0);
 234   1      }
 235             
 236          /****************延迟毫秒数************************/
 237          void Delay_xMs(unsigned int x)
 238          {
 239   1          unsigned int i,j;
 240   1          for( i = 0;i < x;i++ )
 241   1          {
C51 COMPILER V9.60.0.0   MAIN                                                              08/19/2020 14:51:39 PAGE 5   

 242   2              for( j = 0;j<2;j++ );
 243   2          }
 244   1      }
 245          
*** WARNING C294 IN LINE 233 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1253    ----
   CONSTANT SIZE    =    505    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
